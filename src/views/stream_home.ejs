<%- include('common/header', { user: typeof user !== 'undefined' ? user : null, title: '스트리밍' }) %>

<div class="p-5 mb-4 bg-white rounded-3 shadow">
    <div class="container-fluid py-5">
        <h1 class="display-5 fw-bold">라이브 스트리밍</h1>
        <p class="col-md-8 fs-4">실시간 방송을 시청하세요!</p>

        <div class="input-group mb-3" style="max-width: 400px;">
            <input type="text" id="streamKeyInput" class="form-control" placeholder="스트림 키를 입력하세요">
            <button class="btn btn-outline-primary" type="button" id="loadStreamBtn">방송 보기</button>
        </div>

        <!-- RTMP 스트리밍 주소 (Node Media Server 설정에 따라 변경) -->
        <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="640" height="360"
            poster="/static/img/default-poster.jpg" data-setup="{}">
            <source src="http://localhost:8000/live/test.flv" type="video/flv">
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
            </p>
        </video>
    </div>
</div>

<%- include('common/footer') %>

<link href="https://vjs.zencdn.net/7.15.0/video-js.css" rel="stylesheet" />
<script src="https://vjs.zencdn.net/7.15.0/video.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // video.js 플레이어를 초기화합니다.
        const player = videojs('my-video');

        const streamKeyInput = document.getElementById('streamKeyInput');
        const loadStreamBtn = document.getElementById('loadStreamBtn');

        loadStreamBtn.addEventListener('click', function () {
            const streamKey = streamKeyInput.value.trim();
            if (streamKey) {
                const newSource = {
                    src: `http://localhost:8000/live/${streamKey}.flv`,
                    type: 'video/flv'
                };
                player.src(newSource);
                player.load(); // 새로운 소스를 로드합니다.
                player.play(); // 비디오를 재생합니다.
            } else {
                alert('스트림 키를 입력해주세요.');
            }
        });
    });
</script>